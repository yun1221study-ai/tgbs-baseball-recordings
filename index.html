<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>棒球紀錄系統 - 自訂隊伍名稱版</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; max-width: 900px; }
  label { display: block; margin-top: 12px; }
  input, select, button, textarea { padding: 6px; margin-top: 4px; font-size: 1rem; }
  #eventList { margin-top: 16px; max-height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 8px; }
  #eventList li { margin-bottom: 6px; white-space: pre-wrap; }
  .flex { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
  button { cursor: pointer; }
  .small-input { width: 60px; }
  table { border-collapse: collapse; margin-top: 12px; width: 100%; }
  table, th, td { border: 1px solid #ccc; padding: 6px 12px; }
  th { background: #eee; }
  textarea { resize: vertical; min-height: 40px; max-height: 100px; width: 100%; }
</style>
</head>
<body>

<h1>棒球紀錄系統 - 自訂隊伍名稱版</h1>

<section>
  <label>
    新增比賽ID（可自訂，例：2025-08-08 台北 vs 高雄）：
    <input type="text" id="inputGameId" placeholder="輸入比賽識別名稱" />
  </label>
  <label>
    隊伍1名稱：
    <input type="text" id="team1Name" placeholder="隊伍1" />
  </label>
  <label>
    隊伍2名稱：
    <input type="text" id="team2Name" placeholder="隊伍2" />
  </label>
  <button id="btnAddGame" type="button">新增比賽</button>

  <label style="margin-top:12px;">
    選擇比賽：
    <select id="selectGame">
      <option value="" disabled selected>請先新增比賽</option>
    </select>
  </label>

  <label>
    選擇局數：
    <select id="selectInning">
      <option value="1">第1局</option>
      <option value="2">第2局</option>
      <option value="3">第3局</option>
      <option value="4">第4局</option>
      <option value="5">第5局</option>
      <option value="6">第6局</option>
      <option value="7">第7局</option>
      <option value="8">第8局</option>
      <option value="9">第9局</option>
    </select>
  </label>
</section>

<section style="margin-top: 20px; border-top: 2px solid #333; padding-top: 16px;">
  <h2>新增事件（每球紀錄）</h2>
  <div class="flex">
    <label>球數：<input type="number" id="pitchCountInput" class="small-input" min="1" value="1" /></label>
    <label>隊伍：
      <select id="teamSelect">
        <option value="">請選擇隊伍</option>
      </select>
    </label>
    <label>打者：<input type="text" id="batterInput" placeholder="姓名+背號" /></label>
    <label>投球結果：
      <select id="pitchResultSelect">
        <option value="S">好球(S)</option>
        <option value="B">壞球(B)</option>
        <option value="F">界外球(F)</option>
        <option value="X">其他(X)</option>
      </select>
    </label>
    <label>事件類型：
      <select id="eventTypeSelect">
        <option value="">無</option>
        <option value="hit">安打</option>
        <option value="dbl">二壘安打</option>
        <option value="hr">本壘打</option>
        <option value="bb">保送</option>
        <option value="hbp">觸身球</option>
        <option value="so">三振</option>
        <option value="out">出局</option>
        <option value="dp">雙殺</option>
        <option value="e">失誤</option>
        <option value="fc">野手選擇</option>
        <option value="l">殘壘</option>
      </select>
    </label>
    <label>打點(RBI)：<input type="number" id="rbiInput" class="small-input" min="0" value="0" /></label>
    <label>得分：<input type="number" id="runsInput" class="small-input" min="0" value="0" /></label>
  </div>
  <div class="flex" style="margin-top:8px;">
    <label><input type="checkbox" id="base1" /> 一壘有人</label>
    <label><input type="checkbox" id="base2" /> 二壘有人</label>
    <label><input type="checkbox" id="base3" /> 三壘有人</label>
    <label>盜壘：
      <select id="stealSelect">
        <option value="">無</option>
        <option value="SB">成功盜壘</option>
        <option value="CS">盜壘失敗</option>
      </select>
    </label>
  </div>
  <label style="margin-top:8px;">
    備註：
    <textarea id="remarkInput" placeholder="輸入備註內容..."></textarea>
  </label>
  <button id="btnAddEvent" type="button" style="margin-top: 12px;">新增事件</button>
</section>

<section style="margin-top: 20px; border-top: 2px solid #333; padding-top: 16px;">
  <h2>比分表</h2>
  <table>
    <thead>
      <tr>
        <th>局數</th>
        <th id="team1Header">隊伍1</th>
        <th id="team2Header">隊伍2</th>
      </tr>
    </thead>
    <tbody id="scoreTableBody">
      <tr><td colspan="3">請先選擇比賽</td></tr>
    </tbody>
  </table>
</section>

<section style="margin-top: 20px; border-top: 2px solid #333; padding-top: 16px;">
  <h2>事件列表</h2>
  <ul id="eventList"><li>請先選擇比賽</li></ul>
</section>

<script>
  const eventNames = {
    hit: '安打',
    dbl: '二壘安打',
    hr: '本壘打',
    bb: '保送',
    hbp: '觸身球',
    so: '三振',
    out: '出局',
    dp: '雙殺',
    e: '失誤',
    fc: '野手選擇',
    l: '殘壘'
  };

  // DOM Elements
  const inputGameId = document.getElementById('inputGameId');
  const team1NameInput = document.getElementById('team1Name');
  const team2NameInput = document.getElementById('team2Name');
  const btnAddGame = document.getElementById('btnAddGame');
  const selectGame = document.getElementById('selectGame');
  const selectInning = document.getElementById('selectInning');
  const eventList = document.getElementById('eventList');
  const scoreTableBody = document.getElementById('scoreTableBody');
  const team1Header = document.getElementById('team1Header');
  const team2Header = document.getElementById('team2Header');

  const pitchCountInput = document.getElementById('pitchCountInput');
  const teamSelect = document.getElementById('teamSelect');
  const batterInput = document.getElementById('batterInput');
  const pitchResultSelect = document.getElementById('pitchResultSelect');
  const eventTypeSelect = document.getElementById('eventTypeSelect');
  const rbiInput = document.getElementById('rbiInput');
  const runsInput = document.getElementById('runsInput');
  const base1 = document.getElementById('base1');
  const base2 = document.getElementById('base2');
  const base3 = document.getElementById('base3');
  const stealSelect = document.getElementById('stealSelect');
  const remarkInput = document.getElementById('remarkInput');

  // Initialize Data
  let games = JSON.parse(localStorage.getItem('games') || '{}');
  let currentGameId = null;
  let currentInning = Number(selectInning.value);

  // Save to localStorage
  function saveGames() {
    localStorage.setItem('games', JSON.stringify(games));
  }

  // Render Game Options
  function renderGameOptions() {
    selectGame.innerHTML = '';
    const defaultOption = document.createElement('option');
    defaultOption.value = '';
    defaultOption.textContent = '請選擇比賽';
    defaultOption.disabled = true;
    defaultOption.selected = true;
    selectGame.appendChild(defaultOption);

    Object.keys(games).forEach(gid => {
      const option = document.createElement('option');
      option.value = gid;
      option.textContent = gid;
      selectGame.appendChild(option);
    });
  }

  // Render Team Select in event input
  function renderTeamSelectOptions() {
    teamSelect.innerHTML = '<option value="">請選擇隊伍</option>';
    if (!currentGameId) return;
    const g = games[currentGameId];
    if (!g) return;
    teamSelect.appendChild(new Option(g.team1, g.team1));
    teamSelect.appendChild(new Option(g.team2, g.team2));
  }

  // Render Event List
  function renderEventList() {
    eventList.innerHTML = '';
    if (!currentGameId || !games[currentGameId]) {
      eventList.innerHTML = '<li>請先選擇比賽</li>';
      return;
    }
    const innings = games[currentGameId].innings || {};
    const inningEvents = innings[currentInning] || [];
    if (inningEvents.length === 0) {
      eventList.innerHTML = '<li>本局尚無事件紀錄</li>';
      return;
    }
    inningEvents.forEach((ev, i) => {
      const li = document.createElement('li');
      const basesStr = [ev.base1?'一壘':'', ev.base2?'二壘':'', ev.base3?'三壘'].filter(Boolean).join(', ') || '無';
      li.textContent = 
        `球數 ${ev.pitchCount}，隊伍: ${ev.team}，打者: ${ev.batter}，投球結果: ${ev.pitchResult}，事件: ${eventNames[ev.event] || '無'}，RBI: ${ev.rbi}，得分: ${ev.runs}，壘包: ${basesStr}，盜壘: ${ev.steal || '無'}，備註: ${ev.remark || '無'}`;
      eventList.appendChild(li);
    });
  }

  // Render Score Table
  function renderScoreTable() {
    scoreTableBody.innerHTML = '';
    if (!currentGameId || !games[currentGameId]) {
      scoreTableBody.innerHTML = '<tr><td colspan="3">請先選擇比賽</td></tr>';
      return;
    }
    const g = games[currentGameId];
    const inningsScore = g.inningsScore || {};
    const innings = Object.keys(inningsScore).map(Number).sort((a,b)=>a-b);
    if (innings.length === 0) {
      scoreTableBody.innerHTML = '<tr><td colspan="3">尚無比分紀錄</td></tr>';
      return;
    }
    innings.forEach(inning => {
      const s = inningsScore[inning];
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>第${inning}局</td><td>${s[g.team1] || 0}</td><td>${s[g.team2] || 0}</td>`;
      scoreTableBody.appendChild(tr);
    });
  }

  // 新增比賽
  btnAddGame.addEventListener('click', () => {
    const gameId = inputGameId.value.trim();
    const team1 = team1NameInput.value.trim();
    const team2 = team2NameInput.value.trim();

    if (!gameId) return alert('請輸入比賽ID');
    if (!team1) return alert('請輸入隊伍1名稱');
    if (!team2) return alert('請輸入隊伍2名稱');
    if (games[gameId]) return alert('比賽ID已存在');

    games[gameId] = {
      team1,
      team2,
      innings: {},
      inningsScore: {}
    };

    saveGames();
    renderGameOptions();
    inputGameId.value = '';
    team1NameInput.value = '';
    team2NameInput.value = '';
    alert('新增比賽成功！');
  });

  // 選擇比賽事件
  selectGame.addEventListener('change', () => {
    currentGameId = selectGame.value;
    currentInning = Number(selectInning.value);
    if (currentGameId) {
      const g = games[currentGameId];
      team1Header.textContent = g.team1;
      team2Header.textContent = g.team2;
      renderTeamSelectOptions();
      renderEventList();
      renderScoreTable();
    }
  });

  // 選擇局數事件
  selectInning.addEventListener('change', () => {
    currentInning = Number(selectInning.value);
    renderEventList();
  });

  // 新增事件
  btnAddEvent.addEventListener('click', () => {
    if (!currentGameId) return alert('請先選擇比賽');
    const pitchCount = Number(pitchCountInput.value);
    const team = teamSelect.value;
    const batter = batterInput.value.trim();
    const pitchResult = pitchResultSelect.value;
    const event = eventTypeSelect.value;
    const rbi = Number(rbiInput.value);
    const runs = Number(runsInput.value);
    const baseOne = base1.checked;
    const baseTwo = base2.checked;
    const baseThree = base3.checked;
    const steal = stealSelect.value;
    const remark = remarkInput.value.trim();

    if (!pitchCount || !team) return alert('請輸入完整球數與隊伍');
    if (!batter) return alert('請輸入打者姓名');
    
    const game = games[currentGameId];
    if (!game.innings[currentInning]) game.innings[currentInning] = [];
    if (!game.inningsScore[currentInning]) game.inningsScore[currentInning] = { [game.team1]:0, [game.team2]:0 };

    // 新增事件物件
    const eventObj = {
      pitchCount,
      team,
      batter,
      pitchResult,
      event,
      rbi,
      runs,
      base1: baseOne,
      base2: baseTwo,
      base3: baseThree,
      steal,
      remark
    };
    game.innings[currentInning].push(eventObj);

    // 自動更新比分
    game.inningsScore[currentInning][team] += runs;

    saveGames();
    renderEventList();
    renderScoreTable();

    // 清除輸入欄位，保留隊伍與局數方便連續輸入
    pitchCountInput.value = pitchCount + 1;
    batterInput.value = '';
    pitchResultSelect.value = 'S';
    eventTypeSelect.value = '';
    rbiInput.value = 0;
    runsInput.value = 0;
    base1.checked = false;
    base2.checked = false;
    base3.checked = false;
    stealSelect.value = '';
    remarkInput.value = '';
  });

  // 初始化畫面
  renderGameOptions();

</script>

</body>
</html>
