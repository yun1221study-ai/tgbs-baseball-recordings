<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>完整棒球比賽紀錄系統（多場+每局+每球）</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; max-width: 900px; }
  label { display: block; margin-top: 12px; }
  input, select, button { padding: 6px; margin-top: 4px; font-size: 1rem; }
  #eventList { margin-top: 16px; max-height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 8px; }
  #eventList li { margin-bottom: 6px; }
  .flex { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
  button { cursor: pointer; }
  .small-input { width: 60px; }
  table { border-collapse: collapse; margin-top: 12px; }
  table, th, td { border: 1px solid #ccc; padding: 6px 12px; }
  th { background: #eee; }
</style>
</head>
<body>

<h1>完整棒球比賽紀錄系統</h1>

<section>
  <label>
    新增比賽ID（格式可自由，例如：2025-08-08 台北 vs 高雄）：
    <input type="text" id="inputGameId" placeholder="輸入比賽識別名稱" />
    <button id="btnAddGame">新增比賽</button>
  </label>

  <label>
    選擇比賽：
    <select id="selectGame">
      <option value="" disabled selected>請先新增比賽</option>
    </select>
  </label>

  <label>
    選擇局數：
    <select id="selectInning">
      <option value="1">第1局</option>
      <option value="2">第2局</option>
      <option value="3">第3局</option>
      <option value="4">第4局</option>
      <option value="5">第5局</option>
      <option value="6">第6局</option>
      <option value="7">第7局</option>
      <option value="8">第8局</option>
      <option value="9">第9局</option>
    </select>
  </label>
</section>

<section style="margin-top: 20px; border-top: 2px solid #333; padding-top: 16px;">
  <h2>新增事件（每球紀錄）</h2>
  <div class="flex">
    <label>球數：<input type="number" id="pitchCountInput" class="small-input" min="1" value="1" /></label>
    <label>隊伍：
      <select id="teamSelect">
        <option value="home">主隊</option>
        <option value="away">客隊</option>
      </select>
    </label>
    <label>打者：<input type="text" id="batterInput" placeholder="姓名+背號" /></label>
    <label>投球結果：
      <select id="pitchResultSelect">
        <option value="S">好球(S)</option>
        <option value="B">壞球(B)</option>
        <option value="F">界外球(F)</option>
        <option value="X">其他(X)</option>
      </select>
    </label>
    <label>事件類型：
      <select id="eventTypeSelect">
        <option value="">無</option>
        <option value="hit">安打</option>
        <option value="dbl">二壘安打</option>
        <option value="hr">本壘打</option>
        <option value="bb">保送</option>
        <option value="hbp">觸身球</option>
        <option value="so">三振</option>
        <option value="out">出局</option>
        <option value="dp">雙殺</option>
        <option value="e">失誤</option>
        <option value="fc">野手選擇</option>
        <option value="l">殘壘</option>
      </select>
    </label>
    <label>打點(RBI)：<input type="number" id="rbiInput" class="small-input" min="0" value="0" /></label>
    <label>得分：<input type="number" id="runsInput" class="small-input" min="0" value="0" /></label>
  </div>
  <div class="flex" style="margin-top:8px;">
    <label><input type="checkbox" id="base1" /> 一壘有人</label>
    <label><input type="checkbox" id="base2" /> 二壘有人</label>
    <label><input type="checkbox" id="base3" /> 三壘有人</label>
    <label>盜壘：
      <select id="stealSelect">
        <option value="">無</option>
        <option value="SB">成功盜壘</option>
        <option value="CS">盜壘失敗</option>
      </select>
    </label>
  </div>
  <button id="btnAddEvent" style="margin-top: 12px;">新增事件</button>
</section>

<section style="margin-top: 20px; border-top: 2px solid #333; padding-top: 16px;">
  <h2>比分表</h2>
  <table>
    <thead>
      <tr>
        <th>局數</th>
        <th>主隊分數</th>
        <th>客隊分數</th>
      </tr>
    </thead>
    <tbody id="scoreTableBody">
      <tr><td colspan="3">請先選擇比賽</td></tr>
    </tbody>
  </table>
</section>

<section style="margin-top: 20px; border-top: 2px solid #333; padding-top: 16px;">
  <h2>事件列表</h2>
  <ul id="eventList"><li>請先選擇比賽</li></ul>
</section>

<script>
  const eventNames = {
    hit: '安打',
    dbl: '二壘安打',
    hr: '本壘打',
    bb: '保送',
    hbp: '觸身球',
    so: '三振',
    out: '出局',
    dp: '雙殺',
    e: '失誤',
    fc: '野手選擇',
    l: '殘壘'
  };

  // DOM Elements
  const inputGameId = document.getElementById('inputGameId');
  const btnAddGame = document.getElementById('btnAddGame');
  const selectGame = document.getElementById('selectGame');
  const selectInning = document.getElementById('selectInning');
  const eventList = document.getElementById('eventList');
  const scoreTableBody = document.getElementById('scoreTableBody');

  const pitchCountInput = document.getElementById('pitchCountInput');
  const teamSelect = document.getElementById('teamSelect');
  const batterInput = document.getElementById('batterInput');
  const pitchResultSelect = document.getElementById('pitchResultSelect');
  const eventTypeSelect = document.getElementById('eventTypeSelect');
  const rbiInput = document.getElementById('rbiInput');
  const runsInput = document.getElementById('runsInput');
  const base1 = document.getElementById('base1');
  const base2 = document.getElementById('base2');
  const base3 = document.getElementById('base3');
  const stealSelect = document.getElementById('stealSelect');

  // Initialize Data
  let games = JSON.parse(localStorage.getItem('games') || '{}');
  let currentGameId = null;
  let currentInning = Number(selectInning.value);

  // Save to localStorage
  function saveGames() {
    localStorage.setItem('games', JSON.stringify(games));
  }

  // Render Game Options
  function renderGameOptions() {
    selectGame.innerHTML = '';
    const defaultOption = document.createElement('option');
    defaultOption.value = '';
    defaultOption.textContent = '請選擇比賽';
    defaultOption.disabled = true;
    defaultOption.selected = true;
    selectGame.appendChild(defaultOption);

    Object.keys(games).forEach(gid => {
      const option = document.createElement('option');
      option.value = gid;
      option.textContent = gid;
      selectGame.appendChild(option);
    });
  }

  // Render Event List
  function renderEventList() {
    eventList.innerHTML = '';
    if (!currentGameId || !games[currentGameId]) {
      eventList.innerHTML = '<li>請先選擇比賽</li>';
      return;
    }
    const innings = games[currentGameId].innings || {};
    const inningEvents = innings[currentInning] || [];
    if (inningEvents.length === 0) {
      eventList.innerHTML = '<li>本局尚無事件紀錄</li>';
      return;
    }
    inningEvents.forEach((ev, i) => {
      const li = document.createElement('li');
      const basesStr = [ev.base1?'一壘':'', ev.base2?'二壘':'', ev.base3?'三壘'].filter(Boolean).join(', ') || '無';
      li.textContent = 
        `球數 ${ev.pitchCount}，隊伍: ${ev.team === 'home' ? '主隊' : '客隊'}，打者: ${ev.batter}，投球結果: ${ev.pitchResult}，事件: ${eventNames[ev.event] || '無'}，RBI: ${ev.rbi}，得分: ${ev.runs}，壘包: ${basesStr}，盜壘: ${ev.steal || '無'}`;
      eventList.appendChild(li);
    });
  }

  // Render Score Table
  function renderScoreTable() {
    scoreTableBody.innerHTML = '';
    if (!currentGameId || !games[currentGameId]) {
      scoreTableBody.innerHTML = '<tr><td colspan="3">請先選擇比賽</td></tr>';
      return;
    }
    const inningsScore = games[currentGameId].inningsScore || {};
    const innings = Object.keys(inningsScore).map(Number).sort((a,b)=>a-b);
    if (innings.length === 0) {
      scoreTableBody.innerHTML = '<tr><td colspan="3">尚無比分紀錄</td></tr>';
      return;
    }
    innings.forEach(inning => {
      const s = inningsScore[inning];
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>第${inning}局</td><td>${s.home}</td><td>${s.away}</td>`;
      scoreTableBody.appendChild(tr);
    });
  }

  // Add Game
  btnAddGame.addEventListener('click', () => {
    const gid = inputGameId.value.trim();
    if (!gid) return alert('請輸入比賽ID');
    if (games[gid]) return alert('比賽ID已存在');
    games[gid] = { innings: {}, inningsScore: {} };
    saveGames();
    renderGameOptions();
    inputGameId.value = '';
    alert(`比賽【${gid}】新增成功！`);
  });

  // Select Game
  selectGame.addEventListener('change', e => {
    currentGameId = e.target.value;
    renderEventList();
    renderScoreTable();
  });

  // Select Inning
  selectInning.addEventListener('change', e => {
    currentInning = Number(e.target.value);
    renderEventList();
    renderScoreTable();
  });

  // Add Event
  document.getElementById('btnAddEvent').addEventListener('click', () => {
    if (!currentGameId) return alert('請先選擇比賽');
    const pitchCount = Number(pitchCountInput.value) || 1;
    const team = teamSelect.value;
    const batter = batterInput.value.trim() || '未知';
    const pitchResult = pitchResultSelect.value;
    const eventType = eventTypeSelect.value;
    const rbi = Number(rbiInput.value) || 0;
    const runs = Number(runsInput.value) || 0;
    const steal = stealSelect.value || '';
    const base1Val = base1.checked;
    const base2Val = base2.checked;
    const base3Val = base3.checked;

    if (!games[currentGameId].innings) games[currentGameId].innings = {};
    if (!games[currentGameId].innings[currentInning]) games[currentGameId].innings[currentInning] = [];
    if (!games[currentGameId].inningsScore) games[currentGameId].inningsScore = {};
    if (!games[currentGameId].inningsScore[currentInning]) {
      games[currentGameId].inningsScore[currentInning] = { home: 0, away: 0 };
    }

    const newEvent = {
      pitchCount,
      team,
      batter,
      pitchResult,
      event: eventType,
      rbi,
      runs,
      base1: base1Val,
      base2: base2Val,
      base3: base3Val,
      steal,
      time: new Date().toLocaleString()
    };

    games[currentGameId].innings[currentInning].push(newEvent);

    // 自動更新比分
    if (runs > 0) {
      if (team === 'home') {
        games[currentGameId].inningsScore[currentInning].home += runs;
      } else {
        games[currentGameId].inningsScore[currentInning].away += runs;
      }
    }

    saveGames();
    renderEventList();
    renderScoreTable();

    // 自動帶入上一筆資料（部分欄位）
    pitchCountInput.value = pitchCount + 1;
    batterInput.value = batter;
    teamSelect.value = team;
    pitchResultSelect.value = pitchResult;
    eventTypeSelect.value = '';
    rbiInput.value = 0;
    runsInput.value = 0;
    base1.checked = base1Val;
    base2.checked = base2Val;
    base3.checked = base3Val;
    stealSelect.value = '';

  });

  // 頁面初始載入
  renderGameOptions();

</script>

</body>
</html>
